
/* Transfer */

body.xboard-piece-transfer *,
body.xboard-piece-transfer {
	cursor: grabbing;
}

.transfer-provider {
	z-index: 10000;
}

/* Board */

.xboard {
	container-name: board;
	display: grid;
	grid-template-columns: 1fr;
	grid-template-rows: 1fr;
	box-shadow: 3px 3px 5px rgba(17,17,17,0.3);
	background-color: #eee;
	pointer-events: none;
	user-select: none;
}

.xboard [hidden] {
	display: none !important;
}

.xboard > * {
	grid-area: 1/1/2/2;
}
.xboard > .grid {
	display: grid;
}
.xboard > .grid > * {
	grid-area: 1/1/2/2;
}
.xboard > .grid > .squares {
	z-index: 1;
}
.xboard > .rules {
	z-index: 2;
}
.xboard > .grid > .arrows {
	z-index: 3;
}
.xboard > .grid > .pieces {
	z-index: 4;
}
.xboard > .dialog {
	z-index: 5;
}

@property --rules {
  syntax: "fullsize|compact|none";
  inherits: false;
  initial-value: compact;
}

@property --rule-size {
  syntax: "<length>";
  inherits: true;
  initial-value: 27px;
}

@container (width > var(--x)) {
	.grid {
		border: 1px dashed blue;
	}
}

/* FullSize Style */

@container board style(--rules: fullsize){
	.grid {
		margin: var(--rule-size);
	}
	.rules {
		display: grid;
		grid-template-columns: var(--rule-size) 1fr var(--rule-size);
		grid-template-rows: var(--rule-size) 1fr var(--rule-size);
		border: 1px solid #ddd;
	}
	.rules > .rule {
		display: grid;
	}
	.rules > .top {
		grid-area: 1/2/2/-2;
	}
	.rules > .bottom {
		grid-area: -2/2/-1/-2;
	}
	.rules > .left {
		grid-area: 2/1/-2/2;
	}
	.rules > .right {
		grid-area: 2/-2/-2/-1;
	}
	.rules > .rule > .axis {
		display: grid;
		align-content: center;
		justify-content: center;
		container-type: size;
	}
	.rules > .rule > .axis > div {
		font-size: 56cqmin;
		font-weight: bold;
	}
}

/* Compact Style */

@container board style(--rules: compact){
	.grid {
		margin: 0px;
	}
	.rules {
		display: grid;
		grid-template-columns: calc(30% / var(--cols)) 1fr;
		grid-template-rows: 1fr calc(30% / var(--rows));
	}
	.rules > .rule {
		display: grid;
	}
	.rules > .top,
	.rules > .right {
		display: none;
	}
	.rules > .bottom {
		grid-area: 2/1/3/3;
	}
	.rules > .left {
		grid-area: 1/1/3/2;
	}
	.rules > .rule > .axis {
		display: grid;
		align-content: center;
		justify-content: center;
		container-type: size;
	}
	.rules > .rule > .file {
		justify-content: end;
	}
	.rules > .rule > .rank {
		align-content: start;
	}
	.rules > .rule > .axis > div {
		font-size: 60cqmin;
		margin: 30cqmin;
		font-weight: bold;
	}
}

/* None */

@container board style(--rules: none){
	.grid {
		margin: 0px;
	}
	.rules {
		display: none;
	}
}

/* Squares */

.xboard .squares {
	border: 0.9px solid #444;
	display: grid;
	grid-template-columns: repeat(var(--cols), 1fr);
	grid-template-rows: repeat(var(--rows), 1fr);
}

.xboard .square {
	display: grid;
	align-items: center;
	justify-items: center;
	border: 0.9px solid #444;
	grid-area: var(--y) / var(--x);
	aspect-ratio: 1;
	pointer-events: auto;
}

.xboard .square.white {
	background-color: #f5f5f5;
}

.xboard .square.black {
	background-color: #c6bdc9;
}

.xboard .square.white.from,
.xboard .square.white.to {
	background-color: #b7e9fd;
}

.xboard .square.black.from,
.xboard .square.black.to {
	background-color: #97c4da;
}

.xboard .square.white.source {
	background-color: #cea8d9;
}

.xboard .square.black.source {
	background-color: #9b70a7;
}

.xboard-piece-transfer .xboard .square.target {
	border: 3px solid rgba(0, 40, 40, 0.6);
}

.xboard .square.move:not(.capture):before {
	content: "";
	background-color: #81d3f4;
	display: block;
	box-sizing: border-box;
	width: 30%;
	height: 30%;
	align-self: center;
	justify-self: center;
	background-color: rgba(0, 0, 0, 0.3);
	border-radius: 50%;
}

.xboard .square.capture {
	border: 3px solid rgb(229 2 6 / 51%);
}

/* Pieces */

.xboard .pieces {
	position: relative;
	touch-action: none;
}

.xboard .piece {
	position: absolute;
	pointer-events: auto;
	background-size: contain;
	background-repeat: no-repeat;
	background-position: 50% 50%;
	background-color: transparent;
	transition: all 0.2s;
	cursor: grab;
}

.piece.white {
	background-image: url("/res/svg/puzzle-active.svg");
}

.piece.black {
	background-image: url("/res/svg/puzzle.svg");
}

.xboard .piece.check {
	filter: drop-shadow(0px 0px 10px red);
}

.xboard .piece.locked {
	cursor: inherit;
}

.xboard .piece.transfer {
	transition: none;
	z-index: 100;
	filter: drop-shadow(1rem 1rem 0.75rem rgba(0, 0, 0, 0.3));
	cursor: grabbing;
	pointer-events: none;
}

/* Arrows */

.xboard .arrows {
	position: relative;
}

.xboard .arrows > * {
	position: absolute;
	height: calc(40% / var(--rows));
	width: 0px;
	transform-origin: center left;
	transform: rotate(0);
	opacity: 0.5;
	transition: width 0.3s;
	background-repeat: no-repeat;
	background-size: 100% 100%;
	background-size: contain;
	container-type: size;
}

.xboard .arrows > ::before {
	content: "";
	display: block;
	width: 100%;
	height: 100%;
  clip-path: polygon(
  	0 30%,
  	calc(100% - 250cqh) 30%,
  	calc(100% - 270cqh) 0,
  	calc(100% - 100cqh) 50%,
  	calc(100% - 270cqh) 100%,
  	calc(100% - 250cqh) 70%,
  	0 70%
  );
}

.xboard .arrows > .blue::before {
	background-color: blue;
}
.xboard .arrows > .red::before {
	background-color: red;
}
.xboard .arrows > .green::before {
	background-color: green;
}
.xboard .arrows > .yellow::before {
	background-color: yellow;
}

/* Chess Pieces */

.white.king {
	background-image: url("./svg/sjakkpass/white-king.svg");
}
.white.queen {
	background-image: url("./svg/sjakkpass/white-queen.svg");
}
.white.rook {
	background-image: url("./svg/sjakkpass/white-rook.svg");
}
.white.bishop {
	background-image: url("./svg/sjakkpass/white-bishop.svg");
}
.white.knight {
	background-image: url("./svg/sjakkpass/white-knight.svg");
}
.white.pawn {
	background-image: url("./svg/sjakkpass/white-pawn.svg");
}
.black.king {
	background-image: url("./svg/sjakkpass/black-king.svg");
}
.black.queen {
	background-image: url("./svg/sjakkpass/black-queen.svg");
}
.black.rook {
	background-image: url("./svg/sjakkpass/black-rook.svg");
}
.black.bishop {
	background-image: url("./svg/sjakkpass/black-bishop.svg");
}
.black.knight {
	background-image: url("./svg/sjakkpass/black-knight.svg");
}
.black.pawn {
	background-image: url("./svg/sjakkpass/black-pawn.svg");
}

/* Fairy Pieces */
/* Dialog */

.xboard .dialog {
	pointer-events: auto;
	background-color: rgba(0,0,0,0.6);
	display: grid;
	grid-template-rows: 1fr;
	grid-template-columns: 1fr;
	align-items: center;
	justify-items: center;
	container-type: size;
}

.xboard .dialog-target {
	grid-area: 1/1/1/1;
}

/* Promotion */

.xboard .promotion {
	display: grid;
	width: 60cqw;
	gap: calc(6cqmin / var(--cols));
	grid-template-columns: repeat(var(--cols), 1fr);
	grid-template-rows: repeat(var(--rows), 1fr);
}

.xboard .promotion > .promotion-type {
	aspect-ratio: 1 / 1;
	background-color: rgba(255,255,255,0.6);
	background-repeat: no-repeat;
	background-position: 50% 50%;
	cursor: pointer;
	transition: all 0.3s;
}

.xboard .promotion > .promotion-type:hover {
	background-color: rgba(255, 255, 255, 1);
}

/* Palette */

@keyframes palette-new {
	from {transform: scale(0.1)}
	to {transform: scale(1)}
}

.xboard-palette {
	display: grid;
	grid-template-columns: 1fr 1fr;
	grid-auto-rows: 1fr;
	gap: 4px;
	padding: 4px;
	border: 1px solid #ccc;
}

.xboard-palette > * {
	background-repeat: no-repeat;
	background-position: 50% 50%;
	background-size: contain;
	transition: all 0.3s;
}

.xboard-palette > .delete-piece {
	grid-area: 1/1/2/3;
	background-size: auto 60%;
	background-image: url('./svg/trash.svg');
	cursor: pointer;
}

.xboard-palette > .insert-piece {
	cursor: grab;
	aspect-ratio: 1;
	animation: palette-new 0.3s;
	touch-action: none;
}

.xboard-palette > .insert-piece.transfer {
	transition: none;
	z-index: 100;
	filter: drop-shadow(1rem 1rem 0.75rem rgba(0, 0, 0, 0.3));
	cursor: grabbing;
	pointer-events: none;
	background-color: transparent;
}

.xboard-palette > .current {
	background-color: #ddd;
}

/* MoveLog */

.xboard-movelog {
	display: grid;
	overflow: auto;
	align-content: start;
	background-color: #fff;
}

.xboard-movelog > .start {
	text-indent: -1000px;
	overflow: hidden;
	background-image: url("./svg/log-start.svg");
	background-size: 28px;
	background-repeat: no-repeat;
	background-position: 50% 50%;
}

.xboard-movelog > .start.current {
	background-image: url("./svg/log-start-current.svg");
}

.xboard-movelog > .fullmove {
	display: grid;
	grid-template-columns: 40px 1fr 1fr;
}

.xboard-movelog > .fullmove:nth-child(even){
	background-color: rgba(0, 0, 0, 0.06);
}

.xboard-movelog .state {
	cursor: pointer;
}

.xboard-movelog :is(.move, .number) {
	padding: 5px;
}

.xboard-movelog .number {
	grid-area: 1/1/2/2;
	font-size: 16px;
}

.xboard-movelog .move {
	background-position: 0px 36%;
	background-size: 18px;
	background-repeat: no-repeat;
	padding-left: 20px;
	transition: all 0.2s;
}

.xboard-movelog .move.white {
	grid-area: 1/2/2/3;
}

.xboard-movelog .move.black {
	grid-area: 1/3/2/4;
}

.xboard-movelog .move.current {
	font-weight: bold;
	color: #004dd6;
}

.xboard-movelog .move:hover {
	font-weight: bold;
	color: #004dd6;
	cursor: pointer;
}

.xboard-movelog .move.pawn {
	background-image: none;
	padding-left: 2px;
}
.xboard-movelog .black.king {
	background-image: url("./svg/mini-chess/king-black.svg");
}
.xboard-movelog .black.queen {
	background-image: url("./svg/mini-chess/queen-black.svg");
}
.xboard-movelog .black.rook {
	background-image: url("./svg/mini-chess/rook-black.svg");
}
.xboard-movelog .black.bishop {
	background-image: url("./svg/mini-chess/bishop-black.svg");
}
.xboard-movelog .black.knight {
	background-image: url("./svg/mini-chess/knight-black.svg");
}
.xboard-movelog .white.king {
	background-image: url("./svg/mini-chess/king-white.svg");
}
.xboard-movelog .white.queen {
	background-image: url("./svg/mini-chess/queen-white.svg");
}
.xboard-movelog .white.rook {
	background-image: url("./svg/mini-chess/rook-white.svg");
}
.xboard-movelog .white.bishop {
	background-image: url("./svg/mini-chess/bishop-white.svg");
}
.xboard-movelog .white.knight {
	background-image: url("./svg/mini-chess/knight-white.svg");
}